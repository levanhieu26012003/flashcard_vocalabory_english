<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ª®ng d·ª•ng h·ªçc t·ª´ v·ª±ng</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 5px;
            backdrop-filter: blur(10px);
        }

        .tab-button {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            margin: 0 5px;
        }

        .tab-button.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
        }

        /* Add Word Tab */
        .add-form {
            display: grid;
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        /* Flashcard Tab */
        .flashcard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .flashcard {
            width: 400px;
            height: 250px;
            perspective: 1000px;
            cursor: pointer;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }

        .flashcard-front,
        .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .flashcard-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .flashcard-back {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            transform: rotateY(180deg);
        }

        .flashcard-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .word-counter {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }

        /* Test Tab */
        .test-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .test-setup {
            margin-bottom: 30px;
        }

        .test-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .option-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .option-group h3 {
            margin-bottom: 10px;
            color: #555;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .test-question {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }

        .answer-input {
            padding: 15px;
            font-size: 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .test-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
        }

        .correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .test-stats {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            text-align: center;
        }

        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .word-list {
            margin-top: 30px;
        }

        .word-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .word-info {
            flex: 1;
        }

        .word-english {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .word-vietnamese {
            color: #666;
        }

        .word-date {
            font-size: 12px;
            color: #999;
            margin-left: 20px;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        @media (max-width: 768px) {
            .flashcard {
                width: 300px;
                height: 200px;
            }

            .flashcard-front,
            .flashcard-back {
                font-size: 18px;
            }

            .container {
                padding: 10px;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üìö ·ª®ng d·ª•ng h·ªçc t·ª´ v·ª±ng</h1>
            <p>Th√™m t·ª´ - Luy·ªán t·∫≠p - Ki·ªÉm tra</p>
        </div>

        <div class="nav-tabs">
            <button class="tab-button active" onclick="showTab('add')">‚ûï Th√™m t·ª´</button>
            <button class="tab-button" onclick="showTab('flashcard')">üîÑ Flashcard</button>
            <button class="tab-button" onclick="showTab('test')">üìù Ki·ªÉm tra</button>
            <button class="tab-button" onclick="showTab('list')">üìã Danh s√°ch</button>
        </div>

        <!-- Add Word Tab -->
        <div id="add-tab" class="tab-content active">
            <h2 style="text-align: center; margin-bottom: 30px; color: #555;">Th√™m t·ª´ v·ª±ng m·ªõi</h2>
            <div class="add-form">
                <div class="form-group">
                    <label for="english-word">T·ª´ ti·∫øng Anh:</label>
                    <input type="text" id="english-word" placeholder="Nh·∫≠p t·ª´ ti·∫øng Anh...">
                </div>
                <div class="form-group">
                    <label for="vietnamese-meaning">Nghƒ©a ti·∫øng Vi·ªát:</label>
                    <textarea id="vietnamese-meaning" rows="3" placeholder="Nh·∫≠p nghƒ©a ti·∫øng Vi·ªát..."></textarea>
                </div>
                <button class="btn btn-primary" onclick="addWord()">Th√™m t·ª´</button>
            </div>
        </div>

        <!-- Flashcard Tab -->
        <div id="flashcard-tab" class="tab-content">
            <div class="flashcard-container">
                <div class="word-counter" id="word-counter">Ch∆∞a c√≥ t·ª´ n√†o</div>
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div id="card-front">Th√™m t·ª´ ƒë·ªÉ b·∫Øt ƒë·∫ßu h·ªçc</div>
                        </div>
                        <div class="flashcard-back">
                            <div id="card-back">Nghƒ©a s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</div>
                        </div>
                    </div>
                </div>
                <div class="flashcard-controls">
                    <button class="btn btn-primary" onclick="previousCard()">‚¨ÖÔ∏è Tr∆∞·ªõc</button>
                    <button class="btn btn-primary" onclick="flipCard()">üîÑ L·∫≠t</button>
                    <button class="btn btn-primary" onclick="nextCard()">‚û°Ô∏è Sau</button>
                </div>
            </div>
        </div>

        <!-- Test Tab -->
        <div id="test-tab" class="tab-content">
            <div class="test-container">
                <div class="test-setup" id="test-setup">
                    <h2 style="text-align: center; margin-bottom: 30px; color: #555;">C√†i ƒë·∫∑t ki·ªÉm tra</h2>
                    <div class="test-options">
                        <div class="option-group">
                            <h3>H∆∞·ªõng d·ªãch</h3>
                            <div class="checkbox-group">
                                <input type="checkbox" id="en-to-vi" checked>
                                <label for="en-to-vi">Anh ‚Üí Vi·ªát</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="vi-to-en">
                                <label for="vi-to-en">Vi·ªát ‚Üí Anh</label>
                            </div>
                        </div>
                        <div class="option-group">
                            <h3>Ch·ªçn ng√†y h·ªçc</h3>
                            <input type="date" id="selected-date" name="selected-date">
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-primary" onclick="startTest()">B·∫Øt ƒë·∫ßu ki·ªÉm tra</button>
                    </div>
                </div>

                <div class="test-question" id="test-question" style="display: none;">
                    <div class="question-text" id="question-text"></div>
                    <input type="text" class="answer-input" id="answer-input" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..."
                        onkeypress="handleTestKeyPress(event)">
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="checkAnswer()">Ki·ªÉm tra</button>
                        <button class="btn" onclick="skipQuestion()"
                            style="background: #6c757d; color: white; margin-left: 10px;">B·ªè qua</button>
                    </div>
                    <div class="test-result" id="test-result"></div>
                </div>

                <div class="test-stats" id="test-stats" style="display: none;">
                    <h3 style="text-align: center; margin-bottom: 20px;">K·∫øt qu·∫£ ki·ªÉm tra</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="total-questions">0</div>
                            <div class="stat-label">T·ªïng s·ªë c√¢u</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="correct-answers">0</div>
                            <div class="stat-label">ƒê√∫ng</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="wrong-answers">0</div>
                            <div class="stat-label">Sai</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="accuracy">0%</div>
                            <div class="stat-label">ƒê·ªô ch√≠nh x√°c</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="resetTest()">L√†m l·∫°i</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- List Tab -->
        <div id="list-tab" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 30px; color: #555;">Danh s√°ch t·ª´ v·ª±ng</h2>

            <!-- Sync Section -->
            <div style="background: #f0f8ff; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                <h3 style="text-align: center; margin-bottom: 15px; color: #1976d2;">üîÑ ƒê·ªìng b·ªô d·ªØ li·ªáu</h3>
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">
                    <button class="btn" onclick="generateShareLink()" style="background: #4285f4; color: white;">üì± T·∫°o
                        link chia s·∫ª</button>
                    <button class="btn" onclick="showQRCode()" style="background: #ff9800; color: white;">üì≤ T·∫°o QR
                        Code</button>
                    <button class="btn" onclick="showSyncInput()" style="background: #9c27b0; color: white;">üîó Nh·∫≠p
                        link ƒë·ªìng b·ªô</button>
                </div>

                <!-- Share Link Display -->
                <div id="share-link-section" style="display: none; text-align: center; margin-top: 15px;">
                    <p style="margin-bottom: 10px; color: #666;">Link chia s·∫ª (c√≥ hi·ªáu l·ª±c 24h):</p>
                    <div
                        style="background: white; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px;">
                        <input type="text" id="share-link" readonly
                            style="width: 100%; border: none; text-align: center; font-size: 14px; color: #333;">
                    </div>
                    <button class="btn" onclick="copyShareLink()"
                        style="background: #28a745; color: white; font-size: 14px;">üìã Sao ch√©p link</button>
                </div>

                <!-- QR Code Display -->
                <div id="qr-code-section" style="display: none; text-align: center; margin-top: 15px;">
                    <p style="margin-bottom: 10px; color: #666;">Qu√©t QR Code ƒë·ªÉ ƒë·ªìng b·ªô:</p>
                    <div id="qr-code-container" style="display: flex; justify-content: center; margin-bottom: 10px;">
                    </div>
                </div>

                <!-- Sync Input -->
                <div id="sync-input-section" style="display: none; margin-top: 15px;">
                    <input type="text" id="sync-link-input" placeholder="D√°n link ƒë·ªìng b·ªô v√†o ƒë√¢y..."
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px;">
                    <div style="text-align: center;">
                        <button class="btn" onclick="syncFromLink()" style="background: #2196f3; color: white;">üîÑ ƒê·ªìng
                            b·ªô d·ªØ li·ªáu</button>
                        <button class="btn" onclick="hideSyncInput()"
                            style="background: #6c757d; color: white; margin-left: 10px;">‚ùå H·ªßy</button>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn" onclick="exportData()" style="background: #28a745; color: white;">üì• Xu·∫•t
                    file</button>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(event)">
                <button class="btn" onclick="document.getElementById('import-file').click()"
                    style="background: #17a2b8; color: white; margin-left: 10px;">üì§ Nh·∫≠p file</button>
                <button class="btn" onclick="clearAllData()"
                    style="background: #dc3545; color: white; margin-left: 10px;">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
            </div>
            <div class="word-list" id="word-list"></div>
        </div>
    </div>

    <script>
        // Data storage
        let vocabulary = [];
        let currentCardIndex = 0;
        let isCardFlipped = false;

        // Test variables
        let testWords = [];
        let currentTestIndex = 0;
        let testStats = {
            total: 0,
            correct: 0,
            wrong: 0
        };
        let currentQuestion = null;

        // Storage functions
        function saveData() {
            try {
                const data = {
                    vocabulary: vocabulary,
                    currentCardIndex: currentCardIndex
                };
                localStorage.setItem('vocabularyApp', JSON.stringify(data));
            } catch (e) {
                console.log('Kh√¥ng th·ªÉ l∆∞u d·ªØ li·ªáu:', e);
            }
        }
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('selected-date').value = today;

        function loadData() {
            try {
                const savedData = localStorage.getItem('vocabularyApp');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    vocabulary = data.vocabulary || [];
                    currentCardIndex = data.currentCardIndex || 0;

                    // Ensure currentCardIndex is valid
                    if (currentCardIndex >= vocabulary.length) {
                        currentCardIndex = 0;
                    }
                }
            } catch (e) {
                console.log('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu:', e);
                vocabulary = [];
                currentCardIndex = 0;
            }
        }

        // Load data on page load
        window.onload = function () {
            loadData();
            updateFlashcard();
            updateWordList();
        };

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');

            // Update content when switching tabs
            if (tabName === 'flashcard') {
                updateFlashcard();
            } else if (tabName === 'list') {
                updateWordList();
            }
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US'; // ho·∫∑c 'en-US' n·∫øu ƒë·ªçc ti·∫øng Anh
                utterance.rate = 1;       // t·ªëc ƒë·ªô ƒë·ªçc (0.1 -> 10)
                utterance.pitch = 1;      // t√¥ng gi·ªçng (0 -> 2)
                window.speechSynthesis.speak(utterance);
            } else {
                alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªçc vƒÉn b·∫£n!");
            }
        }


        // Add word functionality
        function addWord() {
            const englishWord = document.getElementById('english-word').value.trim();
            const vietnameseMeaning = document.getElementById('vietnamese-meaning').value.trim();

            if (!englishWord || !vietnameseMeaning) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t·ª´ ti·∫øng Anh v√† nghƒ©a ti·∫øng Vi·ªát!');
                return;
            }

            const newWord = {
                id: Date.now(),
                english: englishWord,
                vietnamese: vietnameseMeaning,
                dateAdded: new Date().toISOString()
            };

            vocabulary.push(newWord);
            saveData(); // Save to localStorage

            // Clear inputs
            document.getElementById('english-word').value = '';
            document.getElementById('vietnamese-meaning').value = '';

            updateFlashcard();
            updateWordList();
        }

        // Flashcard functionality
        function updateFlashcard() {
            const counter = document.getElementById('word-counter');
            const cardFront = document.getElementById('card-front');
            const cardBack = document.getElementById('card-back');

            if (vocabulary.length === 0) {
                counter.textContent = 'Ch∆∞a c√≥ t·ª´ n√†o';
                cardFront.textContent = 'Th√™m t·ª´ ƒë·ªÉ b·∫Øt ƒë·∫ßu h·ªçc';
                cardBack.textContent = 'Nghƒ©a s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y';
                return;
            }

            // Ensure current index is valid
            if (currentCardIndex >= vocabulary.length) {
                currentCardIndex = 0;
            }

            const currentWord = vocabulary[currentCardIndex];
            counter.textContent = `T·ª´ ${currentCardIndex + 1} / ${vocabulary.length}`;
            cardFront.textContent = currentWord.english;
            cardBack.textContent = currentWord.vietnamese;

            // Reset flip state
            document.getElementById('flashcard').classList.remove('flipped');
            isCardFlipped = false;
        }

        function flipCard() {
            if (vocabulary.length === 0) return;

            const flashcard = document.getElementById('flashcard');
            flashcard.classList.toggle('flipped');
            isCardFlipped = !isCardFlipped;
        }

        function nextCard() {
            if (vocabulary.length === 0) return;

            currentCardIndex = (currentCardIndex + 1) % vocabulary.length;
            saveData(); // Save current position
            updateFlashcard();
        }

        function previousCard() {
            if (vocabulary.length === 0) return;

            currentCardIndex = currentCardIndex === 0 ? vocabulary.length - 1 : currentCardIndex - 1;
            saveData(); // Save current position
            updateFlashcard();
        }

        // Test functionality
        function startTest() {
            const enToVi = document.getElementById('en-to-vi').checked;
            const viToEn = document.getElementById('vi-to-en').checked;

            if (!enToVi && !viToEn) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt h∆∞·ªõng d·ªãch!');
                return;
            }

            // Filter words by date
            let filteredWords = vocabulary;

            const selectedDateInput = document.getElementById('selected-date');
            const selectedDateValue = selectedDateInput.value;

            if (selectedDateValue) {
                const selectedDate = new Date(selectedDateValue);
                selectedDate.setHours(0, 0, 0, 0); // chu·∫©n h√≥a v·ªÅ ƒë·∫ßu ng√†y

                filteredWords = vocabulary.filter(word => {
                    const wordDate = new Date(word.dateAdded);
                    wordDate.setHours(0, 0, 0, 0); // chu·∫©n h√≥a v·ªÅ ƒë·∫ßu ng√†y ƒë·ªÉ so s√°nh ch√≠nh x√°c
                    return wordDate.getTime() === selectedDate.getTime();
                });
            }

            if (filteredWords.length === 0) {
                alert('Kh√¥ng c√≥ t·ª´ n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc ƒë√£ ch·ªçn!');
                return;
            }

            // Prepare test questions
            testWords = [];
            filteredWords.forEach(word => {
                if (enToVi) {
                    testWords.push({
                        question: word.english,
                        answer: word.vietnamese,
                        type: 'en-to-vi'
                    });
                }
                if (viToEn) {
                    testWords.push({
                        question: word.vietnamese,
                        answer: word.english,
                        type: 'vi-to-en'
                    });
                }
            });

            // Shuffle questions
            testWords = testWords.sort(() => Math.random() - 0.5);

            // Reset test state
            currentTestIndex = 0;
            testStats = { total: 0, correct: 0, wrong: 0 };

            // Show test UI
            document.getElementById('test-setup').style.display = 'none';
            document.getElementById('test-question').style.display = 'block';
            document.getElementById('test-stats').style.display = 'none';

            showNextQuestion();
        }

        function showNextQuestion() {
            if (currentTestIndex >= testWords.length) {
                showTestResults();
                return;
            }

            currentQuestion = testWords[currentTestIndex];
            document.getElementById('question-text').textContent = currentQuestion.question;
            document.getElementById('answer-input').value = '';
            document.getElementById('test-result').innerHTML = '';
            document.getElementById('answer-input').focus();
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answer-input').value.trim().toLowerCase();
            const correctAnswer = currentQuestion.answer.toLowerCase();
            const resultDiv = document.getElementById('test-result');

            testStats.total++;

            if (userAnswer === correctAnswer) {
                testStats.correct++;
                resultDiv.innerHTML = '<div class="correct">‚úÖ ƒê√∫ng r·ªìi!</div>';
            } else {
                testStats.wrong++;
                resultDiv.innerHTML = `<div class="incorrect">‚ùå Sai r·ªìi! ƒê√°p √°n ƒë√∫ng: <strong>${currentQuestion.answer}</strong></div>`;
            }

            speak(currentQuestion.question);

            setTimeout(() => {
                currentTestIndex++;
                showNextQuestion();
            }, 2000);
        }

        function skipQuestion() {
            testStats.total++;
            testStats.wrong++;

            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = `<div class="incorrect">‚è≠Ô∏è ƒê√£ b·ªè qua! ƒê√°p √°n: <strong>${currentQuestion.answer}</strong></div>`;

            setTimeout(() => {
                currentTestIndex++;
                showNextQuestion();
            }, 1500);
        }

        function handleTestKeyPress(event) {
            if (event.key === 'Enter') {
                checkAnswer();
            }
        }

        function showTestResults() {
            document.getElementById('test-question').style.display = 'none';
            document.getElementById('test-stats').style.display = 'block';

            document.getElementById('total-questions').textContent = testStats.total;
            document.getElementById('correct-answers').textContent = testStats.correct;
            document.getElementById('wrong-answers').textContent = testStats.wrong;

            const accuracy = testStats.total > 0 ? Math.round((testStats.correct / testStats.total) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        function resetTest() {
            document.getElementById('test-setup').style.display = 'block';
            document.getElementById('test-question').style.display = 'none';
            document.getElementById('test-stats').style.display = 'none';
        }

        // Word list functionality
        function updateWordList() {
            const wordList = document.getElementById('word-list');

            if (vocabulary.length === 0) {
                wordList.innerHTML = '<p style="text-align: center; color: #666;">Ch∆∞a c√≥ t·ª´ n√†o. H√£y th√™m t·ª´ m·ªõi!</p>';
                return;
            }

            // Sort by date added (newest first)
            const sortedWords = [...vocabulary].sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));

            wordList.innerHTML = sortedWords.map(word => `
                <div class="word-item">
                    <div class="word-info">
                        <div class="word-english">${word.english}</div>
                        <div class="word-vietnamese">${word.vietnamese}</div>
                    </div>
                    <div class="word-date">${new Date(word.dateAdded).toLocaleDateString('vi-VN')}</div>
                    <button class="btn-delete" onclick="deleteWord(${word.id})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function deleteWord(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·ª´ n√†y?')) {
                vocabulary = vocabulary.filter(word => word.id !== id);
                saveData(); // Save to localStorage
                updateWordList();
                updateFlashcard();
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a T·∫§T C·∫¢ d·ªØ li·ªáu? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
                vocabulary = [];
                currentCardIndex = 0;
                localStorage.removeItem('vocabularyApp');
                updateWordList();
                updateFlashcard();
                alert('ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu!');
            }
        }

        function exportData() {
            if (vocabulary.length === 0) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!');
                return;
            }

            const dataStr = JSON.stringify(vocabulary, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `vocabulary_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (Array.isArray(importedData)) {
                        if (confirm('B·∫°n c√≥ mu·ªën thay th·∫ø t·∫•t c·∫£ d·ªØ li·ªáu hi·ªán t·∫°i kh√¥ng?')) {
                            vocabulary = importedData;
                        } else {
                            vocabulary = [...vocabulary, ...importedData];
                        }
                        currentCardIndex = 0;
                        saveData();
                        updateWordList();
                        updateFlashcard();
                        alert('Nh·∫≠p d·ªØ li·ªáu th√†nh c√¥ng!');
                    } else {
                        alert('File kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng!');
                    }
                } catch (error) {
                    alert('L·ªói khi ƒë·ªçc file: ' + error.message);
                }
            };
            reader.readAsText(file);

            // Reset input
            event.target.value = '';
        }

        // Sync functionality
        function generateShareLink() {
            if (vocabulary.length === 0) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ chia s·∫ª!');
                return;
            }

            // Create a unique ID for this share
            const shareId = 'vocab_' + Date.now() + '_' + Math.random().toString(36).substring(2, 15);
            const shareData = {
                id: shareId,
                data: vocabulary,
                timestamp: Date.now(),
                expires: Date.now() + (24 * 60 * 60 * 1000) // 24 hours
            };

            // Store in localStorage with expiration
            localStorage.setItem('share_' + shareId, JSON.stringify(shareData));

            // Create shareable URL
            const baseUrl = window.location.href.split('?')[0];
            const shareUrl = baseUrl + '?sync=' + shareId;

            document.getElementById('share-link').value = shareUrl;
            document.getElementById('share-link-section').style.display = 'block';
            document.getElementById('qr-code-section').style.display = 'none';
            document.getElementById('sync-input-section').style.display = 'none';
        }

        function showQRCode() {
            if (vocabulary.length === 0) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ chia s·∫ª!');
                return;
            }

            // Generate share link first
            generateShareLink();
            const shareUrl = document.getElementById('share-link').value;

            // Create QR code using a simple QR code generator
            const qrContainer = document.getElementById('qr-code-container');
            qrContainer.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #ddd;">
                    <div style="text-align: center;">
                        <div id="qr-code-canvas" style="margin: 0 auto;"></div>
                        <p style="margin-top: 10px; font-size: 12px; color: #666;">Qu√©t b·∫±ng camera ƒëi·ªán tho·∫°i</p>
                    </div>
                </div>
            `;

            // Generate QR code using QR Server API
            const qrImg = document.createElement('img');
            qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(shareUrl)}`;
            qrImg.style.display = 'block';
            qrImg.style.margin = '0 auto';
            document.getElementById('qr-code-canvas').appendChild(qrImg);

            document.getElementById('qr-code-section').style.display = 'block';
            document.getElementById('share-link-section').style.display = 'none';
            document.getElementById('sync-input-section').style.display = 'none';
        }

        function showSyncInput() {
            document.getElementById('sync-input-section').style.display = 'block';
            document.getElementById('share-link-section').style.display = 'none';
            document.getElementById('qr-code-section').style.display = 'none';
            document.getElementById('sync-link-input').value = '';
            document.getElementById('sync-link-input').focus();
        }

        function hideSyncInput() {
            document.getElementById('sync-input-section').style.display = 'none';
        }

        function copyShareLink() {
            const shareLink = document.getElementById('share-link');
            shareLink.select();
            shareLink.setSelectionRange(0, 99999);

            try {
                document.execCommand('copy');
                alert('ƒê√£ sao ch√©p link! G·ª≠i link n√†y cho thi·∫øt b·ªã kh√°c ƒë·ªÉ ƒë·ªìng b·ªô.');
            } catch (err) {
                // Fallback for mobile
                navigator.clipboard.writeText(shareLink.value).then(() => {
                    alert('ƒê√£ sao ch√©p link! G·ª≠i link n√†y cho thi·∫øt b·ªã kh√°c ƒë·ªÉ ƒë·ªìng b·ªô.');
                }).catch(() => {
                    alert('Kh√¥ng th·ªÉ sao ch√©p t·ª± ƒë·ªông. Vui l√≤ng sao ch√©p link th·ªß c√¥ng.');
                });
            }
        }

        function syncFromLink() {
            const syncUrl = document.getElementById('sync-link-input').value.trim();

            if (!syncUrl) {
                alert('Vui l√≤ng nh·∫≠p link ƒë·ªìng b·ªô!');
                return;
            }

            // Extract share ID from URL
            const urlParams = new URLSearchParams(syncUrl.split('?')[1]);
            const shareId = urlParams.get('sync');

            if (!shareId) {
                alert('Link kh√¥ng h·ª£p l·ªá!');
                return;
            }

            // Try to get data from localStorage first (same device)
            const localShareData = localStorage.getItem('share_' + shareId);
            if (localShareData) {
                try {
                    const shareData = JSON.parse(localShareData);

                    // Check if expired
                    if (Date.now() > shareData.expires) {
                        alert('Link ƒë√£ h·∫øt h·∫°n!');
                        return;
                    }

                    // Sync data
                    if (confirm('B·∫°n c√≥ mu·ªën thay th·∫ø t·∫•t c·∫£ d·ªØ li·ªáu hi·ªán t·∫°i kh√¥ng?')) {
                        vocabulary = shareData.data;
                    } else {
                        vocabulary = [...vocabulary, ...shareData.data];
                    }

                    currentCardIndex = 0;
                    saveData();
                    updateWordList();
                    updateFlashcard();
                    hideSyncInput();
                    alert('ƒê·ªìng b·ªô th√†nh c√¥ng!');

                } catch (error) {
                    alert('L·ªói khi ƒë·ªìng b·ªô: ' + error.message);
                }
            } else {
                alert('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu ƒë·ªìng b·ªô. ƒê·∫£m b·∫£o b·∫°n ƒëang s·ª≠ d·ª•ng link t·ª´ c√πng m·ªôt tr√¨nh duy·ªát ho·∫∑c thi·∫øt b·ªã ƒë√£ t·∫°o link.');
            }
        }

        // Check for sync parameter on page load
        function checkSyncOnLoad() {
            const urlParams = new URLSearchParams(window.location.search);
            const shareId = urlParams.get('sync');

            if (shareId) {
                // Auto-show sync input and fill the current URL
                showTab('list');
                setTimeout(() => {
                    showSyncInput();
                    document.getElementById('sync-link-input').value = window.location.href;

                    if (confirm('Ph√°t hi·ªán link ƒë·ªìng b·ªô. B·∫°n c√≥ mu·ªën ƒë·ªìng b·ªô d·ªØ li·ªáu ngay kh√¥ng?')) {
                        syncFromLink();
                    }
                }, 500);
            }
        }

        // Update window.onload to include sync check
        window.onload = function () {
            loadData();
            updateFlashcard();
            updateWordList();
            checkSyncOnLoad();
        };
    </script>
</body>

</html>